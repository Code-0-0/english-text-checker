<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英文文本检查器</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
            background-color: oklch(0.967 0.003 264.542);
        }
        * {box-sizing: border-box; }
        button, input, textarea {font: inherit;}
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            background-color: #f9fafb;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
        }
        .title {
            font-size: 2.25rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .input-area {
            margin-bottom: 1.5rem;
        }
        .input-label {
            display: block;
            font-size: 1rem;
            font-weight: bold;
            color: #374151;
            margin-bottom: 0.5rem;
            opacity: 0.5;
        }
        .input-textarea {
            width: 100%;
            min-height: 120px;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 1rem;
            line-height: 1.5rem;
            color: #4b5563;
            background-color: #fff;
            resize: vertical;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            transition: border-color 0.15s ease-in-out, shadow-sm 0.15s ease-in-out;
            overflow: hidden;
        }
        .input-textarea::placeholder{
            opacity: 0.5;
        }
        .input-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }
        .reference-select {
            display: block;
            font-size: 1rem;
            font-weight: bold;
            color: #374151;
            margin-bottom: 0.5rem;
            opacity: 0.5;
        }
        .select-element {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 1rem;
            color: #4b5563;
            background-color: #fff;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            transition: border-color 0.15s ease-in-out, shadow-sm 0.15s ease-in-out;
            appearance: none; /* 移除默认箭头 */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E"); /* 自定义箭头 */
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1rem;
        }
        .select-element:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }

        .check-button {
            display: inline-flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: medium;
            color: #fff;
            background-color: #3b82f6;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
        }
        .check-button:hover {
            background-color: #2563eb;
        }
        .check-button:active {
            background-color: #1e40af;
            transform: translateY(1px);
        }
        .result-area {
            margin-top: 1.5rem;
            padding: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: #f9fafb;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            transition: opacity 0.3s ease-in-out;
        }
        .result-area.show {
            opacity: .6;
        }
        .result-title {
            font-size: 1rem;
            font-weight:bold;
            color: #1f2937;
            margin-top: 0;
            margin-bottom: 1rem;
            opacity: .5;
        }
        .result-content {
            font-size: 1rem;
            color: #4b5563;
            line-height: 1.75rem;
            white-space: pre-wrap;
        }
        .error-word {
            color: #dc2626;
            background-color: #fee2e2;
            font-weight: bold;
            border-bottom: 1px dashed #dc2626;
        }
        .correct-word {
            color: #16a34a;
            background-color: #dcfce7;
            font-weight: bold;
        }
        .typo {
            color: #f59e0b;
            font-weight: bold;
        }
        .correct {
            color: #16a34a;
            font-weight: bold;
        }
        .button-div{
            display: flex;
            justify-content: flex-end;
            gap: 35px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="input-area">
            <label for="reference-text-select" class="reference-select">选择参考文本：</label>
            <select id="reference-text-select" class="select-element">
            </select>
        </div>
        <div class="input-area">
            <label for="input-text" class="input-label">输入要检查的英文句子或文章：</label>
            <textarea id="input-text" class="input-textarea" placeholder="在此输入英文文本..."></textarea>
        </div>
        <div class="button-div">
            <button id="speak-button" class="check-button" type="button">阅读</button>
            <button id="check-button" class="check-button" type="button">检查文本</button>
            
        </div>
        <div class="result-area" style="display: none;">
            <label for="result-text" class="result-title">检查结果：</label>
            <div id="result-text" class="result-content"></div>
        </div>
    </div>
    <script>
        // 参考文本对象
        const referenceTexts = {};

        const inputTextarea = document.getElementById('input-text');
        const speakButton = document.getElementById('speak-button');
        const checkButton = document.getElementById('check-button');
        const resultArea = document.querySelector('.result-area');
        const resultText = document.getElementById('result-text');
        const referenceTextSelect = document.getElementById('reference-text-select');

        function checkText() {
            const inputText = inputTextarea.value.trim();
            if (!inputText) {
                alert('请输入要检查的文本！');
                return;
            }

            const selectedReferenceKey = referenceTextSelect.value;
            let selectedReferenceText = referenceTexts[selectedReferenceKey];

            const referenceSentences = selectedReferenceText.split('\n').map(s => s.trim());
            const inputSentences = inputText.split('\n').map(s => s.trim());
            let resultHTML = '';
            let hasErrors = false;

            if (inputSentences.length === 0 || (inputSentences.length === 1 && inputSentences[0] === "")) {
                resultText.innerHTML = '<p class="correct">文本检查完成，未发现错误！</p>';
                resultArea.classList.add('show');
                setTimeout(() => {
                    resultArea.classList.remove('show');
                }, 3000);
                return;
            }

            // 确保参考文本和输入文本都有内容
            if (referenceSentences.length === 0) {
                resultText.innerHTML = '<p class="error">参考文本为空，无法进行比较！</p>';
                resultArea.classList.add('show');
                setTimeout(() => {
                    resultArea.classList.remove('show');
                }, 3000);
                return;
            }
            for (let index = 0; index < inputSentences.length; index++) {
                const inputSentence = inputSentences[index];
                // 使用 Math.min 防止索引超出参考文本的范围
                const referenceSentence = referenceSentences[Math.min(index, referenceSentences.length - 1)] || '';
                if (!referenceSentence) {
                    resultHTML += `<p><strong>检查行 ${index + 1}:</strong> ${inputSentence}  <span class="error-word"> (此行在参考文本中不存在，可能为多余内容)</span></p>`;
                    hasErrors = true;
                    continue;
                }

                const wordDiff = getWordDiff(referenceSentence, inputSentence);
                if (wordDiff.length > 0) {
                    resultHTML += `<p>`;
                    wordDiff.forEach(diff => {
                    
                        if (diff.added) {
                            resultHTML += `<span class="error-word">${diff.value}</span>`;
                            hasErrors = true;
                        } else if (diff.removed) {
                            resultHTML += `<span class="correct-word"> (${diff.value})</span>`;
                            hasErrors = true;
                        } else {
                            resultHTML += diff.value;
                        }
                    });
                    resultHTML += `</p>`;
                } else {
                    resultHTML += `<p><strong>检查行 ${index + 1}:</strong> ${inputSentence}  <span> (此行正确)</span></p>`;
                }
            }

            // 检查段落结构 (简单的行数比较)
            if (inputSentences.length !== referenceSentences.length) {
                resultHTML += `<p><span class="error-word">段落结构错误：</span> 输入文本和参考文本的段落数量不一致。</p>`;
                hasErrors = true;
            }

            const finalResultText = hasErrors ? resultHTML : '<p class="correct">文本检查完成，未发现错误！</p>';
            resultArea.style.display = 'block';
            resultText.innerHTML = finalResultText;
            resultArea.classList.add('show');
            // 3秒后隐藏结果
            setTimeout(() => {
                resultArea.classList.remove('show');
            }, 800);
        }

    // 新增函数：将文本分割为单词和空格交替的数组
    function splitIntoWordsAndSpaces(str) {
        const tokens = [];
        const regex = /(\s+)|(\S+)/g; // 匹配连续空格或非空格内容
        let match;
        while ((match = regex.exec(str)) !== null) {
            if (match[1]) {
                tokens.push(match[1]); // 空格部分
            } else if (match[2]) {
                tokens.push(match[2]); // 单词部分
            }
        }
        return tokens;
    }

    function getWordDiff(reference, input) {
        const refWords = splitIntoWordsAndSpaces(reference);
        const inputWords = splitIntoWordsAndSpaces(input);
        
        const diff = [];
        let i = 0;
        let j = 0;
        
        while (i < refWords.length || j < inputWords.length) {
            if (i < refWords.length && j < inputWords.length && refWords[i] === inputWords[j]) {
                diff.push({ value: refWords[i] });
                i++;
                j++;
            } else {
                // 处理空格差异的特殊逻辑
                const isRefSpace = i < refWords.length && /^\s+$/.test(refWords[i]);
                const isInputSpace = j < inputWords.length && /^\s+$/.test(inputWords[j]);
                
                if (isRefSpace || isInputSpace) {
                    // 空格类型差异直接标记
                    if (j < inputWords.length) {
                        diff.push({ value: inputWords[j], added: true });
                        j++;
                    }
                    if (i < refWords.length) {
                        diff.push({ value: refWords[i], removed: true });
                        i++;
                    }
                } else {
                    // 增加邻近单词匹配逻辑
                    const lookAhead = 3; // 最大向前查看3个单词
                    let matchFound = false;
                    
                    // 尝试在后续单词中寻找匹配
                    for (let k = 1; k <= lookAhead; k++) {
                        if (i+k < refWords.length && j+k < inputWords.length 
                            && refWords[i+k] === inputWords[j+k]) {
                            // 记录当前差异
                            diff.push(
                                { value: inputWords[j], added: true },
                                { value: refWords[i], removed: true }
                            );
                            i++;
                            j++;
                            matchFound = true;
                            break;
                        }
                    }
                    if (!matchFound) {
                        if (j < inputWords.length) diff.push({ value: inputWords[j], added: true });
                        if (i < refWords.length) diff.push({ value: refWords[i], removed: true });
                        i++;
                        j++;
                    }
                }
            }
        }
        return diff;
    }

        checkButton.addEventListener('click', checkText);
        
        inputTextarea.addEventListener('keydown', (event) => {
            if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {
                checkText();
                event.preventDefault();
            }
        });

        referenceTextSelect.addEventListener('change', () => {
            inputTextarea.value = '';
            inputTextarea.dispatchEvent(new Event('input'));
            resultText.innerHTML = '';
            resultArea.style.display = 'none';
            inputTextarea.focus();
        });
        
        inputTextarea.addEventListener('input', function () {
            const minHeight = parseInt(getComputedStyle(this).minHeight) || 0;
            this.style.height = 'auto';
            const newHeight = Math.max(this.scrollHeight, minHeight);
            this.style.height = newHeight + 'px';
        });
        
        // GitHub Gist URL
        const gistId = '68f20f64d189ff4c37b162b02ecdb5a8'; // 替换为你的 Gist ID
        const apiUrl = `https://api.github.com/gists/${gistId}`;
        
        // 初始化参考文本选择器
        function initializeReferenceSelector() {
            referenceTextSelect.innerHTML = ''; // 清空下拉框
            for (const key in referenceTexts) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = key === 'default' ? '默认文本' : key;
                referenceTextSelect.appendChild(option);
            }
        }
        
const _0x36af=['c0xsQWs=','Y0hIdkU=','YkpxS0k=','UXZnc0M=','VE9IQXU=','QkhDeGw=','enVOT3I=','VnZEWmo=','b1BSenc=','QnhabGY=','anNvbg==','ZGVmYXVsdA==','YmVEbHY=','ZXJyb3I=','S1lrcFk=','aWtnbGQ=','VnZzVEo=','ZU9ValA=','RXJyb3IgZmV0Y2hpbmcgR2lzdDo=','YXBwbHk=','Y29tcGlsZQ==','bk5BWUQ=','SU5rTHI=','UGppR2U=','d2Fybg==','aWJKZHc=','dGhlbg==','QkNjRkI=','a0hHaHk=','T2xaakE=','UEVIbFk=','VWhyYUk=','aW5mbw==','YWdkbVA=','SVdQVHo=','cnVWZnI=','dHJhY2U=','ekpSQUc=','amtMUkM=','Z0hBaWM=','YmNNV2s=','b25sb2Fk','XihbXiBdKyggK1teIF0rKSspK1teIF19','QldOR0E=','aUhHZXg=','6Kej5p6QIEdpc3Qg5YaF5a655pe25Y+R55Sf6ZSZ6K+v77yM6K+35qOA5p+lIEdpc3Qg55qE5YaF5a655piv5ZCm5Li65pyJ5pWI55qEIOaWh+acrO+8gQ==','aGNDcU4=','cXJKSWc=','Z2hwX25YNWlTWVFCd2Y1Zk9LOHZhelB3UG9ZeU9CSmNpbTQ2TzJxVA==','R2lzdCDlhoXlrrnkuI3mmK/mnInmlYjnmoQg5paH5pys','ZGVidWc=','V3NRd3o=','e30uY29uc3RydWN0b3IoInJldHVybiB0aGlzIikoICk=','c1Z2S2I=','Tk14TUE=','Y2F0Y2g=','d3FyQnI=','Y29uc3RydWN0b3I=','RndTZ2k=','dGFibGU=','R2VmREw=','enFHYlg=','ZmlsZXM=','WnBNVko=','bG9n','cmF3X3VybA==','WGFqV00=','dG9rZW4g','TEpVaFY=','c3BsaXQ=','cmV0dXJuIC8iICsgdGhpcyArICIv','Vm5kekM=','YmVxWEw=','Q0FmeFo=','S0lUUUU=','YXBwbGljYXRpb24vdm5kLmdpdGh1Yi52Mytqc29u','TVNDSXA=','a2V5cw==','TllaUkY=','UkVRb1M=','R2lzdCDlhoXlrrnml6DmlYjvvIzor7fnoa7kv53kuIrkvKDnmoTmmK/mnInmlYjnmoQg5paH5pys77yB','ZXhjZXB0aW9u','Z1BKWUw=','TXFybFQ=','QllQT0E=','Y29uc29sZQ==','ak1haFc=','YUpCZm8=','eE1LckU='];(function(_0x5726a4,_0x36af8f){const _0x513d66=function(_0x34af66){while(--_0x34af66){_0x5726a4['push'](_0x5726a4['shift']());}};const _0xde1318=function(){const _0xab14c1={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x5b1c5a,_0x1630b0,_0x1f5786,_0x776659){_0x776659=_0x776659||{};let _0x5bea51=_0x1630b0+'='+_0x1f5786;let _0x2641b8=0x0;for(let _0x28816c=0x0,_0x57da7c=_0x5b1c5a['length'];_0x28816c<_0x57da7c;_0x28816c++){const _0x40f76e=_0x5b1c5a[_0x28816c];_0x5bea51+=';\x20'+_0x40f76e;const _0x6db9f7=_0x5b1c5a[_0x40f76e];_0x5b1c5a['push'](_0x6db9f7);_0x57da7c=_0x5b1c5a['length'];if(_0x6db9f7!==!![]){_0x5bea51+='='+_0x6db9f7;}}_0x776659['cookie']=_0x5bea51;},'removeCookie':function(){return'dev';},'getCookie':function(_0x4f751a,_0x170d7a){_0x4f751a=_0x4f751a||function(_0x1e172c){return _0x1e172c;};const _0x356f9b=_0x4f751a(new RegExp('(?:^|;\x20)'+_0x170d7a['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));const _0x37042a=function(_0xd8e534,_0x591dde){_0xd8e534(++_0x591dde);};_0x37042a(_0x513d66,_0x36af8f);return _0x356f9b?decodeURIComponent(_0x356f9b[0x1]):undefined;}};const _0x32f994=function(){const _0x348e0c=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x348e0c['test'](_0xab14c1['removeCookie']['toString']());};_0xab14c1['updateCookie']=_0x32f994;let _0x17f7a5='';const _0x2e4f84=_0xab14c1['updateCookie']();if(!_0x2e4f84){_0xab14c1['setCookie'](['*'],'counter',0x1);}else if(_0x2e4f84){_0x17f7a5=_0xab14c1['getCookie'](null,'counter');}else{_0xab14c1['removeCookie']();}};_0xde1318();}(_0x36af,0x1d2));const _0x513d=function(_0x5726a4,_0x36af8f){_0x5726a4=_0x5726a4-0x0;let _0x513d66=_0x36af[_0x5726a4];if(_0x513d['jBmfvY']===undefined){(function(){let _0x34af66;try{const _0x32f994=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x34af66=_0x32f994();}catch(_0x17f7a5){_0x34af66=window;}const _0xab14c1='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x34af66['atob']||(_0x34af66['atob']=function(_0x2e4f84){const _0x5b1c5a=String(_0x2e4f84)['replace'](/=+$/,'');let _0x1630b0='';for(let _0x1f5786=0x0,_0x776659,_0x5bea51,_0x2641b8=0x0;_0x5bea51=_0x5b1c5a['charAt'](_0x2641b8++);~_0x5bea51&&(_0x776659=_0x1f5786%0x4?_0x776659*0x40+_0x5bea51:_0x5bea51,_0x1f5786++%0x4)?_0x1630b0+=String['fromCharCode'](0xff&_0x776659>>(-0x2*_0x1f5786&0x6)):0x0){_0x5bea51=_0xab14c1['indexOf'](_0x5bea51);}return _0x1630b0;});}());_0x513d['ZHlTvP']=function(_0x28816c){const _0x57da7c=atob(_0x28816c);let _0x40f76e=[];for(let _0x6db9f7=0x0,_0x4f751a=_0x57da7c['length'];_0x6db9f7<_0x4f751a;_0x6db9f7++){_0x40f76e+='%'+('00'+_0x57da7c['charCodeAt'](_0x6db9f7)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x40f76e);};_0x513d['vFHcne']={};_0x513d['jBmfvY']=!![];}const _0xde1318=_0x513d['vFHcne'][_0x5726a4];if(_0xde1318===undefined){const _0x170d7a=function(_0x356f9b){this['wBTChZ']=_0x356f9b;this['gkSCES']=[0x1,0x0,0x0];this['kAzrPr']=function(){return'newState';};this['BScVgm']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*';this['iiIgoi']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x170d7a['prototype']['cVmaNJ']=function(){const _0x37042a=new RegExp(this['BScVgm']+this['iiIgoi']);const _0x1e172c=_0x37042a['test'](this['kAzrPr']['toString']())?--this['gkSCES'][0x1]:--this['gkSCES'][0x0];return this['TOCDaq'](_0x1e172c);};_0x170d7a['prototype']['TOCDaq']=function(_0xd8e534){if(!Boolean(~_0xd8e534)){return _0xd8e534;}return this['KgBwaS'](this['wBTChZ']);};_0x170d7a['prototype']['KgBwaS']=function(_0x591dde){for(let _0x348e0c=0x0,_0x4d3f21=this['gkSCES']['length'];_0x348e0c<_0x4d3f21;_0x348e0c++){this['gkSCES']['push'](Math['round'](Math['random']()));_0x4d3f21=this['gkSCES']['length'];}return _0x591dde(this['gkSCES'][0x0]);};new _0x170d7a(_0x513d)['cVmaNJ']();_0x513d66=_0x513d['ZHlTvP'](_0x513d66);_0x513d['vFHcne'][_0x5726a4]=_0x513d66;}else{_0x513d66=_0xde1318;}return _0x513d66;};const _0x5b1c5a=function(){let _0x2b0c8f=!![];return function(_0x2b5918,_0x54fdc1){const _0x1220e6=_0x2b0c8f?function(){if(_0x54fdc1){const _0x770ae7=_0x54fdc1[_0x513d('0x57')](_0x2b5918,arguments);_0x54fdc1=null;return _0x770ae7;}}:function(){};_0x2b0c8f=![];return _0x1220e6;};}();const _0x2e4f84=_0x5b1c5a(this,function(){const _0x55cb8c={};_0x55cb8c[_0x513d('0x4c')]=_0x513d('0x31');_0x55cb8c[_0x513d('0x44')]=_0x513d('0x15');const _0xbd72fe=_0x55cb8c;const _0x58f4fb=function(){const _0x7e9c9a=_0x58f4fb[_0x513d('0x24')](_0xbd72fe[_0x513d('0x4c')])()[_0x513d('0x58')](_0xbd72fe[_0x513d('0x44')]);return!_0x7e9c9a['test'](_0x2e4f84);};return _0x58f4fb();});_0x2e4f84();const _0xab14c1=function(){const _0x46f82b={};_0x46f82b[_0x513d('0x11')]=function(_0x442f21,_0x4589f3){return _0x442f21!==_0x4589f3;};_0x46f82b[_0x513d('0x12')]=_0x513d('0x7');_0x46f82b['VvsTJ']=_0x513d('0x1a');_0x46f82b[_0x513d('0x49')]=function(_0x26efa9,_0x12a877){return _0x26efa9!==_0x12a877;};_0x46f82b[_0x513d('0x33')]='Gist\x20内容不是有效的\x20文本';_0x46f82b['KITQE']=function(_0x7284f7,_0xfacff4){return _0x7284f7(_0xfacff4);};_0x46f82b[_0x513d('0x47')]=function(_0x5195f5,_0x54fec3){return _0x5195f5!==_0x54fec3;};const _0x2e4e23=_0x46f82b;let _0x1375c2=!![];return function(_0x3eb445,_0x203389){const _0x57678c={};_0x57678c['cHHvE']=function(_0x5c268f,_0x2cb11b){return _0x2e4e23[_0x513d('0x49')](_0x5c268f,_0x2cb11b);};_0x57678c[_0x513d('0x4b')]='default';_0x57678c[_0x513d('0x17')]=_0x2e4e23[_0x513d('0x33')];_0x57678c[_0x513d('0x16')]=function(_0x334449,_0x3c326b){return _0x2e4e23[_0x513d('0x35')](_0x334449,_0x3c326b);};const _0x2351db=_0x57678c;if(_0x2e4e23[_0x513d('0x47')](_0x513d('0x27'),'bvYUm')){const _0x576bd7=_0x1375c2?function(){if(_0x203389){if(_0x2e4e23['jkLRC'](_0x2e4e23[_0x513d('0x12')],_0x2e4e23[_0x513d('0x54')])){const _0xae2eba=_0x203389[_0x513d('0x57')](_0x3eb445,arguments);_0x203389=null;return _0xae2eba;}else{if(_0x2351db[_0x513d('0x45')](key,_0x2351db['VvDZj'])){delete referenceTexts[key];}}}}:function(){};_0x1375c2=![];return _0x576bd7;}else{console[_0x513d('0x51')](_0x2351db[_0x513d('0x17')]);_0x2351db['BWNGA'](alert,_0x513d('0x3b'));}};}();const _0x34af66=_0xab14c1(this,function(){const _0x2b9d7a={};_0x2b9d7a[_0x513d('0x3d')]=function(_0x4e6f7a,_0x4df46c){return _0x4e6f7a+_0x4df46c;};_0x2b9d7a['aJBfo']='return\x20(function()\x20';_0x2b9d7a[_0x513d('0x41')]=_0x513d('0x1f');_0x2b9d7a[_0x513d('0x34')]=_0x513d('0x3a');_0x2b9d7a[_0x513d('0x2a')]=_0x513d('0xc');_0x2b9d7a[_0x513d('0x0')]=function(_0x398157){return _0x398157();};_0x2b9d7a[_0x513d('0x6')]=function(_0x11b17c,_0x2febcc){return _0x11b17c===_0x2febcc;};_0x2b9d7a[_0x513d('0x23')]=_0x513d('0x2d');_0x2b9d7a[_0x513d('0x37')]=function(_0x193e1d,_0x5c0d0a){return _0x193e1d===_0x5c0d0a;};_0x2b9d7a[_0x513d('0x53')]=_0x513d('0x48');_0x2b9d7a[_0x513d('0x13')]='4|2|7|6|1|0|5|3';const _0x5d3a4d=_0x2b9d7a;const _0x363a6b=function(){};const _0x2e6748=function(){let _0x45a28e;try{_0x45a28e=Function(_0x5d3a4d[_0x513d('0x3d')](_0x5d3a4d[_0x513d('0x3d')](_0x5d3a4d[_0x513d('0x42')],_0x5d3a4d[_0x513d('0x41')]),');'))();}catch(_0x34e2c5){_0x45a28e=window;}return _0x45a28e;};const _0x441021=_0x5d3a4d[_0x513d('0x0')](_0x2e6748);if(!_0x441021['console']){if(_0x5d3a4d[_0x513d('0x6')](_0x5d3a4d['wqrBr'],_0x513d('0x46'))){_0x441021[_0x513d('0x40')][_0x513d('0x2b')]=_0x363a6b;_0x441021['console'][_0x513d('0x3')]=_0x363a6b;_0x441021['console'][_0x513d('0x1d')]=_0x363a6b;_0x441021[_0x513d('0x40')]['info']=_0x363a6b;_0x441021[_0x513d('0x40')]['error']=_0x363a6b;_0x441021['console'][_0x513d('0x3c')]=_0x363a6b;_0x441021[_0x513d('0x40')]['table']=_0x363a6b;_0x441021[_0x513d('0x40')][_0x513d('0xf')]=_0x363a6b;}else{_0x441021[_0x513d('0x40')]=function(_0x3b1074){if(_0x5d3a4d[_0x513d('0x34')]===_0x5d3a4d[_0x513d('0x2a')]){if(fn){const _0x1a6231=fn[_0x513d('0x57')](context,arguments);fn=null;return _0x1a6231;}}else{const _0x57fd27={};_0x57fd27[_0x513d('0x2b')]=_0x3b1074;_0x57fd27[_0x513d('0x3')]=_0x3b1074;_0x57fd27[_0x513d('0x1d')]=_0x3b1074;_0x57fd27[_0x513d('0xb')]=_0x3b1074;_0x57fd27['error']=_0x3b1074;_0x57fd27[_0x513d('0x3c')]=_0x3b1074;_0x57fd27[_0x513d('0x26')]=_0x3b1074;_0x57fd27[_0x513d('0xf')]=_0x3b1074;return _0x57fd27;}}(_0x363a6b);}}else{if(_0x5d3a4d[_0x513d('0x37')](_0x513d('0x48'),_0x5d3a4d[_0x513d('0x53')])){const _0x13e543=_0x5d3a4d[_0x513d('0x13')][_0x513d('0x30')]('|');let _0x4b8776=0x0;while(!![]){switch(_0x13e543[_0x4b8776++]){case'0':_0x441021[_0x513d('0x40')][_0x513d('0x3c')]=_0x363a6b;continue;case'1':_0x441021[_0x513d('0x40')][_0x513d('0x51')]=_0x363a6b;continue;case'2':_0x441021[_0x513d('0x40')][_0x513d('0x3')]=_0x363a6b;continue;case'3':_0x441021[_0x513d('0x40')][_0x513d('0xf')]=_0x363a6b;continue;case'4':_0x441021[_0x513d('0x40')][_0x513d('0x2b')]=_0x363a6b;continue;case'5':_0x441021[_0x513d('0x40')]['table']=_0x363a6b;continue;case'6':_0x441021[_0x513d('0x40')]['info']=_0x363a6b;continue;case'7':_0x441021[_0x513d('0x40')][_0x513d('0x1d')]=_0x363a6b;continue;}break;}}else{globalObject=window;}}});_0x34af66();window[_0x513d('0x14')]=function(){const _0x380aca={};_0x380aca[_0x513d('0x50')]=function(_0x99d701,_0x2ff48f){return _0x99d701(_0x2ff48f);};_0x380aca['INkLr']='return\x20(function()\x20';_0x380aca['BYPOA']=function(_0x221fed,_0x5b2fd0){return _0x221fed!==_0x5b2fd0;};_0x380aca['zuNOr']=_0x513d('0x19');_0x380aca['aRdgj']=function(_0x30d36a,_0x2d125c){return _0x30d36a===_0x2d125c;};_0x380aca['zqGbX']='OlZjA';_0x380aca[_0x513d('0x55')]=function(_0x104d4b,_0x4001e0){return _0x104d4b!==_0x4001e0;};_0x380aca['OPzyW']=_0x513d('0x43');_0x380aca[_0x513d('0x4')]=_0x513d('0x1c');_0x380aca[_0x513d('0x2f')]='Gist\x20内容无效，请确保上传的是有效的\x20文本！';_0x380aca[_0x513d('0x32')]='Error\x20parsing\x20Gist\x20文本:';_0x380aca[_0x513d('0xa')]='解析\x20Gist\x20内容时发生错误，请检查\x20Gist\x20的内容是否为有效的\x20文本！';_0x380aca[_0x513d('0x3e')]=function(_0x192538,_0xbde7c){return _0x192538(_0xbde7c);};_0x380aca[_0x513d('0xd')]=function(_0x581ff2,_0x2ca075){return _0x581ff2===_0x2ca075;};_0x380aca[_0x513d('0x10')]='GJYMW';_0x380aca[_0x513d('0x9')]=_0x513d('0x56');_0x380aca['NYZRF']=function(_0xe91c5c){return _0xe91c5c();};_0x380aca[_0x513d('0x1e')]=function(_0x1779fd,_0x502854,_0x4555ca){return _0x1779fd(_0x502854,_0x4555ca);};_0x380aca[_0x513d('0x52')]=_0x513d('0x36');const _0x1db626=_0x380aca;const _0x181223=_0x513d('0x1b');_0x1db626['WsQwz'](fetch,apiUrl,{'headers':{'Authorization':_0x513d('0x2e')+_0x181223,'Accept':_0x1db626[_0x513d('0x52')]}})[_0x513d('0x5')](_0x4769c8=>_0x4769c8[_0x513d('0x4e')]())[_0x513d('0x5')](_0x56d0cb=>{const _0x4a580b=Object[_0x513d('0x38')](_0x56d0cb[_0x513d('0x29')])[0x0];const _0x47069a=_0x56d0cb[_0x513d('0x29')][_0x4a580b][_0x513d('0x2c')];return _0x1db626[_0x513d('0x50')](fetch,_0x47069a);})['then'](_0x5d9224=>_0x5d9224['text']())[_0x513d('0x5')](_0x5b95a8=>{const _0x3fb218={};_0x3fb218[_0x513d('0x20')]=function(_0x3770c8,_0x46537e){return _0x1db626[_0x513d('0x50')](_0x3770c8,_0x46537e);};_0x3fb218[_0x513d('0x2')]=function(_0x2eaf5c,_0x431f2a){return _0x1db626[_0x513d('0x50')](_0x2eaf5c,_0x431f2a);};_0x3fb218[_0x513d('0xe')]=function(_0x356f5c,_0x17a875){return _0x356f5c+_0x17a875;};_0x3fb218['NMxMA']=_0x1db626[_0x513d('0x1')];const _0x5739ba=_0x3fb218;try{if(_0x1db626[_0x513d('0x3f')](_0x513d('0x25'),_0x1db626[_0x513d('0x4a')])){const _0x1f9a15=JSON['parse'](_0x5b95a8);if(_0x1db626['aRdgj'](typeof _0x1f9a15,'object')&&_0x1db626[_0x513d('0x3f')](_0x1f9a15,null)){for(const _0x57c25f in referenceTexts){if(_0x1db626[_0x513d('0x28')]===_0x513d('0x8')){if(_0x1db626[_0x513d('0x55')](_0x57c25f,_0x513d('0x4f'))){delete referenceTexts[_0x57c25f];}}else{const _0x2f527d=Object['keys'](data[_0x513d('0x29')])[0x0];const _0x383dbc=data[_0x513d('0x29')][_0x2f527d]['raw_url'];return _0x5739ba['sVvKb'](fetch,_0x383dbc);}}Object['assign'](referenceTexts,_0x1f9a15);}else{if(_0x1db626[_0x513d('0x55')](_0x1db626['OPzyW'],_0x1db626['OPzyW'])){let _0x29f85f;try{_0x29f85f=_0x5739ba[_0x513d('0x2')](Function,_0x5739ba['ruVfr'](_0x5739ba[_0x513d('0x21')]+_0x513d('0x1f'),');'))();}catch(_0x4db599){_0x29f85f=window;}return _0x29f85f;}else{console[_0x513d('0x51')](_0x1db626['ibJdw']);_0x1db626['beDlv'](alert,_0x1db626[_0x513d('0x2f')]);}}}else{if(fn){const _0x180937=fn[_0x513d('0x57')](context,arguments);fn=null;return _0x180937;}}}catch(_0x33ddc9){console[_0x513d('0x51')](_0x1db626['VndzC'],_0x33ddc9);_0x1db626[_0x513d('0x50')](alert,_0x1db626[_0x513d('0xa')]);}initializeReferenceSelector();})[_0x513d('0x22')](_0xaf66fa=>{if(_0x1db626[_0x513d('0xd')](_0x513d('0x4d'),_0x1db626[_0x513d('0x10')])){console['error'](_0x1db626[_0x513d('0x32')],_0xaf66fa);_0x1db626[_0x513d('0x3e')](alert,_0x513d('0x18'));}else{console[_0x513d('0x51')](_0x1db626['PEHlY'],_0xaf66fa);_0x1db626[_0x513d('0x39')](initializeReferenceSelector);}});};
    </script>
<style>
.speaker{display:none;width:48px;height:16px;cursor:pointer;position:fixed;top:270px;right:1px}
.setting{width:48px;height:48px;cursor:pointer;position:fixed;bottom:15px;right:6px}
#dialogOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);display:none;justify-content:center;align-items:center}
#dialogBox{background-color:#fff;padding:20px;border-radius:5px;box-shadow:0 0 10px rgba(0,0,0,.3)}
.dialogbox-button{background-color:#777774;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;font-size:16px;margin:10px;width:120px}
.dialogbox-button:hover{background-color:#666664}
.wd{display:none;position:fixed;bottom:10px;left:10px;padding:10px;background-color:#f0f0f0;border:1px solid #666664;border-radius:10px;align-items:center;gap:8px;box-shadow:2px 2px 8px rgb(42 42 42)}
.sw{font-family:Arial,sans-serif;font-size:30px;max-width:400px;overflow:hidden;white-space:nowrap}
.cb{cursor:pointer;font-weight:700}
</style>
<div class='speaker'>
<svg viewBox="0 0 50 50"><g><path fill="#e5e5e5" d="M42.756,7.501l-1.412,1.414c4.296,4.3,6.661,10.018,6.661,16.102c0,6.081-2.365,11.799-6.659,16.099l1.412,1.414c4.672-4.678,7.244-10.897,7.244-17.513C50.003,18.4,47.429,12.179,42.756,7.501z M0,16.003v18.004l11.004-0.005l19,13v-44l-19,13L0,16.003z M28.004,7.001v36l-16-11L1.997,32.006V18.003l10.006-0.001L28.004,7.001z M34.05,14.226c2.879,2.883,4.954,6.699,4.954,10.776c0,4.076-2.075,7.925-4.954,10.807l1.412,1.414c3.256-3.26,5.542-7.611,5.542-12.222c0-4.611-2.286-8.93-5.542-12.19L34.05,14.226z"/></g></svg>
</div>
<div class='setting' onclick="showSettingsDialog()"><svg viewBox="0 0 512 512"><title/><g><path fill="#e5e5e5" d="M293.9,450H233.53a15,15,0,0,1-14.92-13.42l-4.47-42.09a152.77,152.77,0,0,1-18.25-7.56L163,413.53a15,15,0,0,1-20-1.06l-42.69-42.69a15,15,0,0,1-1.06-20l26.61-32.93a152.15,152.15,0,0,1-7.57-18.25L76.13,294.1a15,15,0,0,1-13.42-14.91V218.81A15,15,0,0,1,76.13,203.9l42.09-4.47a152.15,152.15,0,0,1,7.57-18.25L99.18,148.25a15,15,0,0,1,1.06-20l42.69-42.69a15,15,0,0,1,20-1.06l32.93,26.6a152.77,152.77,0,0,1,18.25-7.56l4.47-42.09A15,15,0,0,1,233.53,48H293.9a15,15,0,0,1,14.92,13.42l4.46,42.09a152.91,152.91,0,0,1,18.26,7.56l32.92-26.6a15,15,0,0,1,20,1.06l42.69,42.69a15,15,0,0,1,1.06,20l-26.61,32.93a153.8,153.8,0,0,1,7.57,18.25l42.09,4.47a15,15,0,0,1,13.41,14.91v60.38A15,15,0,0,1,451.3,294.1l-42.09,4.47a153.8,153.8,0,0,1-7.57,18.25l26.61,32.93a15,15,0,0,1-1.06,20L384.5,412.47a15,15,0,0,1-20,1.06l-32.92-26.6a152.91,152.91,0,0,1-18.26,7.56l-4.46,42.09A15,15,0,0,1,293.9,450ZM247,420h33.39l4.09-38.56a15,15,0,0,1,11.06-12.91A123,123,0,0,0,325.7,356a15,15,0,0,1,17,1.31l30.16,24.37,23.61-23.61L372.06,328a15,15,0,0,1-1.31-17,122.63,122.63,0,0,0,12.49-30.14,15,15,0,0,1,12.92-11.06l38.55-4.1V232.31l-38.55-4.1a15,15,0,0,1-12.92-11.06A122.63,122.63,0,0,0,370.75,187a15,15,0,0,1,1.31-17l24.37-30.16-23.61-23.61-30.16,24.37a15,15,0,0,1-17,1.31,123,123,0,0,0-30.14-12.49,15,15,0,0,1-11.06-12.91L280.41,78H247l-4.09,38.56a15,15,0,0,1-11.07,12.91A122.79,122.79,0,0,0,201.73,142a15,15,0,0,1-17-1.31L154.6,116.28,131,139.89l24.38,30.16a15,15,0,0,1,1.3,17,123.41,123.41,0,0,0-12.49,30.14,15,15,0,0,1-12.91,11.06l-38.56,4.1v33.38l38.56,4.1a15,15,0,0,1,12.91,11.06A123.41,123.41,0,0,0,156.67,311a15,15,0,0,1-1.3,17L131,358.11l23.61,23.61,30.17-24.37a15,15,0,0,1,17-1.31,122.79,122.79,0,0,0,30.13,12.49,15,15,0,0,1,11.07,12.91ZM449.71,279.19h0Z"/><path fill="#e5e5e5"  d="M263.71,340.36A91.36,91.36,0,1,1,355.08,249,91.46,91.46,0,0,1,263.71,340.36Zm0-152.72A61.36,61.36,0,1,0,325.08,249,61.43,61.43,0,0,0,263.71,187.64Z"/></g></svg></div>
<div id="dialogOverlay">
    <div id="dialogBox">
        <h2>语音选项</h2>
        <label for="voiceSelect"><h4>语音库</h4></label>
        <select id="voiceSelect" onchange="chVoice(this)"></select>
        <br>
        <h4>语速<span id="vr" style="padding-left:10px;"></span></h4>
        <input type="range" id="rateRange" min="0" max="2" step="0.1" value="1" style="width:100%;" oninput="chRate(this)">
        <br>
        <div style='text-align:center;'>
        <p id="additionalText"><h4>There is no royal road to learning.</h4></p>
        <button class="dialogbox-button" onclick="readaloud('There is no royal road to learning.')">测试</button>
        <button class="dialogbox-button" onclick="closeSettingsDialog()">关闭</button>
        </div>
    </div>
</div>
<div class="wd">
    <span class="sw"></span>
    <span class="cb">&#10005;</span>
</div>
<script type="text/javascript">
const synth = window.speechSynthesis;
const voice = 'Aria';
const utter = new SpeechSynthesisUtterance();
const speaker = document.querySelector('.speaker');
let voices;
synth.onvoiceschanged = function() {
    if (voices) return;
    voices = synth.getVoices();
    var voiceSelect = document.getElementById("voiceSelect");
    voices.forEach(function(v) {
        if (v.lang == 'en-US') {
            var option = document.createElement("option");
            option.textContent = v.name;
            option.setAttribute("value", v.name);
            if (v.name.includes(voice)) {
                utter.voice = v;
                utter.rate = 1;
                option.selected = true;
            }
            voiceSelect.appendChild(option);
        }
    });
};

speaker.addEventListener("click", function(event) {
    synth.cancel();
})

utter.onstart = (event) => {
    speaker.style.display = 'block';
};

utter.onend = (event) => {
    speaker.style.display = 'none';
};

utter.onerror = (event) => {
    speaker.style.display = 'none';
};

function readaloud(text) {
    if (!text || synth.speaking) return;
    utter.text = text;
    synth.speak(utter)
}

function showSettingsDialog() {
    document.getElementById("dialogOverlay").style.display = "flex";
    const rate = utter.rate.toFixed(1);
    document.getElementById('rateRange').value = rate;
    document.getElementById('vr').innerHTML = rate;
}

function closeSettingsDialog() {
    document.getElementById("dialogOverlay").style.display = "none";
}

function chVoice(selectObject) {
    var value = selectObject.value;  
    for (const v of voices) {
        if (v.name.includes(selectObject.value)) {
            utter.voice = v;
            break;
        }
    }
}

function chRate(selectObject){
    const rate = selectObject.value;
    document.getElementById('vr').innerHTML = rate;
    utter.rate = rate;
}

let timer = null;
const delay = 200; // 延时200毫秒区分单击和双击
let prevent = false; // 用于标记是否阻止单击事件的执行

speakButton.addEventListener('click', function(){
    readaloud(referenceTexts[referenceTextSelect.value]);
});

document.addEventListener('dblclick', function(event) {
    clearTimeout(timer);
    prevent = true;
});

document.addEventListener('mouseup', function(e) {
    let selectedText = window.getSelection().toString().trim();
    if (selectedText.length > 0) {
		let selectedWordElement = document.querySelector('.sw');
        selectedWordElement.textContent = selectedText;
        document.querySelector('.wd').style.display = 'flex';
        selectedWordElement.onclick = function() {
            readaloud(selectedText);
        };
    }
});

function closeDisplay() {
    document.querySelector('.wd').style.display = 'none';
}

document.querySelector('.cb').addEventListener('click', closeDisplay);

</script>
</body>
</html>
