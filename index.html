<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英文文本检查器</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
            background-color: oklch(0.967 0.003 264.542);
        }
        * {box-sizing: border-box;margin: 0;padding:0;border: 0;}
        button, input, textarea {font: inherit;}
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            background-color: #f9fafb;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
        }
        .title {
            font-size: 2.25rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .input-area {
            margin-bottom: 1.5rem;
        }
        .input-label {
            display: block;
            font-size: 1rem;
            font-weight: bold;
            color: #374151;
            margin-bottom: 0.5rem;
            opacity: 0.5;
        }
        .input-textarea {
            width: 100%;
            min-height: 120px;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 1rem;
            line-height: 1.5rem;
            color: #4b5563;
            background-color: #fff;
            resize: vertical;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            transition: border-color 0.15s ease-in-out, shadow-sm 0.15s ease-in-out;
            overflow: hidden;
        }
        .input-textarea::placeholder{
            opacity: 0.5;
        }
        .input-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }
        .reference-select {
            display: block;
            font-size: 1rem;
            font-weight: bold;
            color: #374151;
            margin-bottom: 0.5rem;
            opacity: 0.5;
        }
        .select-element {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 1rem;
            color: #4b5563;
            background-color: #fff;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            transition: border-color 0.15s ease-in-out, shadow-sm 0.15s ease-in-out;
            appearance: none; /* 移除默认箭头 */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E"); /* 自定义箭头 */
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1rem;
        }
        .select-element:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }

        .check-button {
            display: inline-flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: medium;
            color: #fff;
            background-color: #3b82f6;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
        }
        .check-button:hover {
            background-color: #2563eb;
        }
        .check-button:active {
            background-color: #1e40af;
            transform: translateY(1px);
        }
        .result-area {
            margin-top: 1.5rem;
            padding: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: #f9fafb;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            transition: opacity 0.3s ease-in-out;
        }
        .result-area.show {
            opacity: .6;
        }
        .result-title {
            font-size: 1rem;
            font-weight:bold;
            color: #1f2937;
            margin-top: 0;
            margin-bottom: 1rem;
            opacity: .5;
        }
        .result-content {
            font-size: 1rem;
            color: #4b5563;
            line-height: 1.75rem;
            white-space: pre-wrap;
        }
        .error-word {
            color: #dc2626;
            background-color: #fee2e2;
            font-weight: bold;
            border-bottom: 1px dashed #dc2626;
        }
        .correct-word {
            color: #16a34a;
            background-color: #dcfce7;
            font-weight: bold;
        }
        .typo {
            color: #f59e0b;
            font-weight: bold;
        }
        .correct {
            color: #16a34a;
            font-weight: bold;
        }
        .button-div{
            display: flex;
            justify-content: flex-end;
            gap: 35px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="input-area">
            <label for="reference-text-select" class="reference-select">选择参考文本：</label>
            <select id="reference-text-select" class="select-element">
            </select>
        </div>
        <div class="input-area">
            <label for="input-text" class="input-label">输入要检查的英文句子或文章：</label>
            <textarea id="input-text" class="input-textarea" placeholder="在此输入英文文本..."></textarea>
        </div>
        <div class="button-div">
            <button id="speak-button" class="check-button" type="button">阅读</button>
            <button id="check-button" class="check-button" type="button">检查文本</button>
            
        </div>
        <div class="result-area" style="display: none;">
            <label for="result-text" class="result-title">检查结果：</label>
            <div id="result-text" class="result-content"></div>
        </div>
    </div>
    <script>
        // 参考文本对象
        const referenceTexts = {};

        const inputTextarea = document.getElementById('input-text');
        const speakButton = document.getElementById('speak-button');
        const checkButton = document.getElementById('check-button');
        const resultArea = document.querySelector('.result-area');
        const resultText = document.getElementById('result-text');
        const referenceTextSelect = document.getElementById('reference-text-select');

        function checkText() {
            const inputText = inputTextarea.value.trim();
            if (!inputText) {
                alert('请输入要检查的文本！');
                return;
            }

            const selectedReferenceKey = referenceTextSelect.value;
            let selectedReferenceText = referenceTexts[selectedReferenceKey];

            const referenceSentences = selectedReferenceText.split('\n').map(s => s.trim());
            const inputSentences = inputText.split('\n').map(s => s.trim());
            let resultHTML = '';
            let hasErrors = false;

            if (inputSentences.length === 0 || (inputSentences.length === 1 && inputSentences[0] === "")) {
                resultText.innerHTML = '<p class="correct">文本检查完成，未发现错误！</p>';
                resultArea.classList.add('show');
                setTimeout(() => {
                    resultArea.classList.remove('show');
                }, 3000);
                return;
            }

            // 确保参考文本和输入文本都有内容
            if (referenceSentences.length === 0) {
                resultText.innerHTML = '<p class="error">参考文本为空，无法进行比较！</p>';
                resultArea.classList.add('show');
                setTimeout(() => {
                    resultArea.classList.remove('show');
                }, 3000);
                return;
            }
            for (let index = 0; index < inputSentences.length; index++) {
                const inputSentence = inputSentences[index];
                // 使用 Math.min 防止索引超出参考文本的范围
                const referenceSentence = referenceSentences[Math.min(index, referenceSentences.length - 1)] || '';
                if (!referenceSentence) {
                    resultHTML += `<p><strong>检查行 ${index + 1}:</strong> ${inputSentence}  <span class="error-word"> (此行在参考文本中不存在，可能为多余内容)</span></p>`;
                    hasErrors = true;
                    continue;
                }

                const wordDiff = getWordDiff(referenceSentence, inputSentence);
                if (wordDiff.length > 0) {
                    resultHTML += `<p>`;
                    wordDiff.forEach(diff => {
                    
                        if (diff.added) {
                            resultHTML += `<span class="error-word">${diff.value}</span>`;
                            hasErrors = true;
                        } else if (diff.removed) {
                            resultHTML += `<span class="correct-word"> (${diff.value})</span>`;
                            hasErrors = true;
                        } else {
                            resultHTML += diff.value;
                        }
                    });
                    resultHTML += `</p>`;
                } else {
                    resultHTML += `<p><strong>检查行 ${index + 1}:</strong> ${inputSentence}  <span> (此行正确)</span></p>`;
                }
            }

            // 检查段落结构 (简单的行数比较)
            if (inputSentences.length !== referenceSentences.length) {
                resultHTML += `<p><span class="error-word">段落结构错误：</span> 输入文本和参考文本的段落数量不一致。</p>`;
                hasErrors = true;
            }

            const finalResultText = hasErrors ? resultHTML : '<p class="correct">文本检查完成，未发现错误！</p>';
            resultArea.style.display = 'block';
            resultText.innerHTML = finalResultText;
            resultArea.classList.add('show');
            // 3秒后隐藏结果
            setTimeout(() => {
                resultArea.classList.remove('show');
            }, 800);
        }

    // 新增函数：将文本分割为单词和空格交替的数组
    function splitIntoWordsAndSpaces(str) {
        const tokens = [];
        const regex = /(\s+)|(\S+)/g; // 匹配连续空格或非空格内容
        let match;
        while ((match = regex.exec(str)) !== null) {
            if (match[1]) {
                tokens.push(match[1]); // 空格部分
            } else if (match[2]) {
                tokens.push(match[2]); // 单词部分
            }
        }
        return tokens;
    }

    function getWordDiff(reference, input) {
        const refWords = splitIntoWordsAndSpaces(reference);
        const inputWords = splitIntoWordsAndSpaces(input);
        
        const diff = [];
        let i = 0;
        let j = 0;
        
        while (i < refWords.length || j < inputWords.length) {
            if (i < refWords.length && j < inputWords.length && refWords[i] === inputWords[j]) {
                diff.push({ value: refWords[i] });
                i++;
                j++;
            } else {
                // 处理空格差异的特殊逻辑
                const isRefSpace = i < refWords.length && /^\s+$/.test(refWords[i]);
                const isInputSpace = j < inputWords.length && /^\s+$/.test(inputWords[j]);
                
                if (isRefSpace || isInputSpace) {
                    // 空格类型差异直接标记
                    if (j < inputWords.length) {
                        diff.push({ value: inputWords[j], added: true });
                        j++;
                    }
                    if (i < refWords.length) {
                        diff.push({ value: refWords[i], removed: true });
                        i++;
                    }
                } else {
                    // 增加邻近单词匹配逻辑
                    const lookAhead = 3; // 最大向前查看3个单词
                    let matchFound = false;
                    
                    // 尝试在后续单词中寻找匹配
                    for (let k = 1; k <= lookAhead; k++) {
                        if (i+k < refWords.length && j+k < inputWords.length 
                            && refWords[i+k] === inputWords[j+k]) {
                            // 记录当前差异
                            diff.push(
                                { value: inputWords[j], added: true },
                                { value: refWords[i], removed: true }
                            );
                            i++;
                            j++;
                            matchFound = true;
                            break;
                        }
                    }
                    if (!matchFound) {
                        if (j < inputWords.length) diff.push({ value: inputWords[j], added: true });
                        if (i < refWords.length) diff.push({ value: refWords[i], removed: true });
                        i++;
                        j++;
                    }
                }
            }
        }
        return diff;
    }

        checkButton.addEventListener('click', checkText);
        
        inputTextarea.addEventListener('keydown', (event) => {
            if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {
                checkText();
                event.preventDefault();
            }
        });

        referenceTextSelect.addEventListener('change', () => {
            inputTextarea.value = '';
            inputTextarea.dispatchEvent(new Event('input'));
            resultText.innerHTML = '';
            resultArea.style.display = 'none';
            inputTextarea.focus();
        });
        
        inputTextarea.addEventListener('input', function () {
            const minHeight = parseInt(getComputedStyle(this).minHeight) || 0;
            this.style.height = 'auto';
            const newHeight = Math.max(this.scrollHeight, minHeight);
            this.style.height = newHeight + 'px';
        });
        
        // GitHub Gist URL
        const gistId = '68f20f64d189ff4c37b162b02ecdb5a8'; // 替换为你的 Gist ID
        const apiUrl = `https://api.github.com/gists/${gistId}`;
        
        // 初始化参考文本选择器
        function initializeReferenceSelector() {
            referenceTextSelect.innerHTML = ''; // 清空下拉框
            for (const key in referenceTexts) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = key === 'default' ? '默认文本' : key;
                referenceTextSelect.appendChild(option);
            }
        }
        
const _0x2e8c=['b25sb2Fk','THFrWmg=','VWd5Zmk=','a2V5cw==','VmRXUFY=','ZmlsZXM=','ZGVmYXVsdA==','WFlybkM=','c3BsaXQ=','Z0VMeWs=','cmF3X3VybA==','YXBwbGljYXRpb24vdm5kLmdpdGh1Yi52Mytqc29u','cmV0dXJuIC8iICsgdGhpcyArICIv','R25OenA=','SUVnamc=','dHVvTEc=','eXVhS0Q=','bVZxT2E=','SEpXYmc=','eVN4UXQ=','6Kej5p6QIEdpc3Qg5YaF5a655pe25Y+R55Sf6ZSZ6K+v77yM6K+35qOA5p+lIEdpc3Qg55qE5YaF5a655piv5ZCm5Li65pyJ5pWI55qEIOaWh+acrO+8gQ==','ZUFIdnE=','bGhzQlg=','ZGVidWc=','akNaamI=','UUhPd2w=','S01JZWM=','bG9n','e30uY29uc3RydWN0b3IoInJldHVybiB0aGlzIikoICk=','R2lzdCDlhoXlrrnkuI3mmK/mnInmlYjnmoQg5paH5pys','dGFibGU=','dGV4dA==','b3ptbnI=','aG5NcUo=','ZVFma3k=','bWxHanA=','Y29uc29sZQ==','WU5Nbms=','SFdoQno=','ZHNCa2M=','UkJNdk8=','dHJhY2U=','TUhqQ2k=','aUxOeGg=','cXpySGE=','VG5jbng=','ZG9Odkw=','UXB3bW8=','Z2hwX3JGZGhiVkxTNlFvMGUyV3RxcjVnTGFFbmJHQ0NlejE3bnB6Yg==','Y29tcGlsZQ==','SG5QamE=','MXw2fDd8NHwzfDB8NXwy','RU1rRlk=','ZXJyb3I=','dHdxbmo=','RXVmbE4=','dkNnaHI=','T1pOVW4=','aUdTRHc=','dGVzdA==','eEpUekY=','RmxGeGE=','cmV0dXJuIChmdW5jdGlvbigpIA==','VmxZR1g=','RXJyb3IgcGFyc2luZyBHaXN0IOaWh+acrDo=','dGhlbg==','S3ZVbE0=','cGFyc2U=','WW9DTW0=','bEd1T1Y=','d2Fybg==','RHNIU0I=','T1JDS3E=','SE5lTGo=','YXBwbHk=','R2lzdCDlhoXlrrnml6DmlYjvvIzor7fnoa7kv53kuIrkvKDnmoTmmK/mnInmlYjnmoQg5paH5pys77yB','b2JqZWN0','cFJ0TFk=','endKSG4=','V3Juc1E=','RkV1TXk=','ZlNzSlU=','anNvbg==','V2ZiYlE=','R21QbHQ=','Vk1LcG0=','bnVCamM=','RVBYQm4=','UUxMR3I=','TVFCT1E=','RUF0d2o=','Y2F0Y2g=','ZXhjZXB0aW9u','YXNzaWdu','blJSTGE=','aW5mbw==','M3w2fDJ8NHw1fDF8MHw3','SVRQc1A='];(function(_0x3ab1af,_0x2e8c79){const _0x581dc0=function(_0x32f011){while(--_0x32f011){_0x3ab1af['push'](_0x3ab1af['shift']());}};const _0x516dbd=function(){const _0x1769d9={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x288930,_0x514fc2,_0x525815,_0x1cca85){_0x1cca85=_0x1cca85||{};let _0x8f086a=_0x514fc2+'='+_0x525815;let _0x5a1a1b=0x0;for(let _0x4a29de=0x0,_0x18b75f=_0x288930['length'];_0x4a29de<_0x18b75f;_0x4a29de++){const _0x261285=_0x288930[_0x4a29de];_0x8f086a+=';\x20'+_0x261285;const _0x549816=_0x288930[_0x261285];_0x288930['push'](_0x549816);_0x18b75f=_0x288930['length'];if(_0x549816!==!![]){_0x8f086a+='='+_0x549816;}}_0x1cca85['cookie']=_0x8f086a;},'removeCookie':function(){return'dev';},'getCookie':function(_0x3200a8,_0x920ba2){_0x3200a8=_0x3200a8||function(_0x42649e){return _0x42649e;};const _0x1c3a40=_0x3200a8(new RegExp('(?:^|;\x20)'+_0x920ba2['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));const _0x5e12de=function(_0x29c90d,_0x39b559){_0x29c90d(++_0x39b559);};_0x5e12de(_0x581dc0,_0x2e8c79);return _0x1c3a40?decodeURIComponent(_0x1c3a40[0x1]):undefined;}};const _0xa53b16=function(){const _0x2acb51=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x2acb51['test'](_0x1769d9['removeCookie']['toString']());};_0x1769d9['updateCookie']=_0xa53b16;let _0x357a35='';const _0x2d4008=_0x1769d9['updateCookie']();if(!_0x2d4008){_0x1769d9['setCookie'](['*'],'counter',0x1);}else if(_0x2d4008){_0x357a35=_0x1769d9['getCookie'](null,'counter');}else{_0x1769d9['removeCookie']();}};_0x516dbd();}(_0x2e8c,0x15a));const _0x581d=function(_0x3ab1af,_0x2e8c79){_0x3ab1af=_0x3ab1af-0x0;let _0x581dc0=_0x2e8c[_0x3ab1af];if(_0x581d['pxHBxH']===undefined){(function(){let _0x32f011;try{const _0xa53b16=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x32f011=_0xa53b16();}catch(_0x357a35){_0x32f011=window;}const _0x1769d9='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x32f011['atob']||(_0x32f011['atob']=function(_0x2d4008){const _0x288930=String(_0x2d4008)['replace'](/=+$/,'');let _0x514fc2='';for(let _0x525815=0x0,_0x1cca85,_0x8f086a,_0x5a1a1b=0x0;_0x8f086a=_0x288930['charAt'](_0x5a1a1b++);~_0x8f086a&&(_0x1cca85=_0x525815%0x4?_0x1cca85*0x40+_0x8f086a:_0x8f086a,_0x525815++%0x4)?_0x514fc2+=String['fromCharCode'](0xff&_0x1cca85>>(-0x2*_0x525815&0x6)):0x0){_0x8f086a=_0x1769d9['indexOf'](_0x8f086a);}return _0x514fc2;});}());_0x581d['qMWntb']=function(_0x4a29de){const _0x18b75f=atob(_0x4a29de);let _0x261285=[];for(let _0x549816=0x0,_0x3200a8=_0x18b75f['length'];_0x549816<_0x3200a8;_0x549816++){_0x261285+='%'+('00'+_0x18b75f['charCodeAt'](_0x549816)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x261285);};_0x581d['IyaPgO']={};_0x581d['pxHBxH']=!![];}const _0x516dbd=_0x581d['IyaPgO'][_0x3ab1af];if(_0x516dbd===undefined){const _0x920ba2=function(_0x1c3a40){this['bADRJa']=_0x1c3a40;this['EzMLmb']=[0x1,0x0,0x0];this['mruLei']=function(){return'newState';};this['tftZhV']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*';this['BitZYc']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x920ba2['prototype']['PDtjzo']=function(){const _0x5e12de=new RegExp(this['tftZhV']+this['BitZYc']);const _0x42649e=_0x5e12de['test'](this['mruLei']['toString']())?--this['EzMLmb'][0x1]:--this['EzMLmb'][0x0];return this['UEghRJ'](_0x42649e);};_0x920ba2['prototype']['UEghRJ']=function(_0x29c90d){if(!Boolean(~_0x29c90d)){return _0x29c90d;}return this['yyifNr'](this['bADRJa']);};_0x920ba2['prototype']['yyifNr']=function(_0x39b559){for(let _0x2acb51=0x0,_0x2b6d27=this['EzMLmb']['length'];_0x2acb51<_0x2b6d27;_0x2acb51++){this['EzMLmb']['push'](Math['round'](Math['random']()));_0x2b6d27=this['EzMLmb']['length'];}return _0x39b559(this['EzMLmb'][0x0]);};new _0x920ba2(_0x581d)['PDtjzo']();_0x581dc0=_0x581d['qMWntb'](_0x581dc0);_0x581d['IyaPgO'][_0x3ab1af]=_0x581dc0;}else{_0x581dc0=_0x516dbd;}return _0x581dc0;};const _0x288930=function(){const _0x396be8={};_0x396be8[_0x581d('0x2f')]=_0x581d('0x34');_0x396be8['twqnj']=function(_0x4d0375,_0x11ea1e){return _0x4d0375===_0x11ea1e;};_0x396be8[_0x581d('0x3d')]='USxzu';_0x396be8[_0x581d('0x1f')]=_0x581d('0x23');const _0x4cdf3f=_0x396be8;let _0x452166=!![];return function(_0x35b841,_0x5d889e){const _0x5d0719={};_0x5d0719['aQLBn']=function(_0x45ca0a,_0x40773e){return _0x4cdf3f[_0x581d('0x2')](_0x45ca0a,_0x40773e);};const _0x138027=_0x5d0719;if(_0x4cdf3f[_0x581d('0x2')](_0x4cdf3f[_0x581d('0x3d')],_0x4cdf3f['WfbbQ'])){if(key!==_0x4cdf3f[_0x581d('0x2f')]){delete referenceTexts[key];}}else{const _0x3f22da=_0x452166?function(){if(_0x5d889e){if(_0x138027['aQLBn'](_0x581d('0x5c'),_0x581d('0x10'))){delete referenceTexts[key];}else{const _0x1b453e=_0x5d889e[_0x581d('0x16')](_0x35b841,arguments);_0x5d889e=null;return _0x1b453e;}}}:function(){};_0x452166=![];return _0x3f22da;}};}();const _0x2d4008=_0x288930(this,function(){const _0x4b20d6={};_0x4b20d6['fSsJU']=_0x581d('0x3a');_0x4b20d6[_0x581d('0x20')]='^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}';_0x4b20d6[_0x581d('0x3e')]=function(_0x34ed40){return _0x34ed40();};const _0xb1d3bc=_0x4b20d6;const _0x2ff598=function(){const _0x1d998=_0x2ff598['constructor'](_0xb1d3bc[_0x581d('0x1d')])()[_0x581d('0x5f')](_0xb1d3bc[_0x581d('0x20')]);return!_0x1d998[_0x581d('0x7')](_0x2d4008);};return _0xb1d3bc[_0x581d('0x3e')](_0x2ff598);});_0x2d4008();const _0x1769d9=function(){const _0x4cfe25={};_0x4cfe25[_0x581d('0x32')]=function(_0x5bd119,_0x137a4c){return _0x5bd119===_0x137a4c;};_0x4cfe25[_0x581d('0x1c')]=_0x581d('0x37');_0x4cfe25[_0x581d('0x5')]='Gist\x20内容不是有效的\x20文本';_0x4cfe25[_0x581d('0x24')]=function(_0x412661,_0x235e1f){return _0x412661(_0x235e1f);};_0x4cfe25[_0x581d('0x25')]=_0x581d('0x17');_0x4cfe25[_0x581d('0x8')]=function(_0x31b965,_0x516561){return _0x31b965===_0x516561;};const _0x44a681=_0x4cfe25;let _0x2b6648=!![];return function(_0x2041bd,_0x3c4782){const _0x4fd014={};_0x4fd014[_0x581d('0x26')]=function(_0x3039b3,_0x4011b9){return _0x44a681[_0x581d('0x32')](_0x3039b3,_0x4011b9);};_0x4fd014[_0x581d('0x4f')]=_0x581d('0x5d');_0x4fd014[_0x581d('0x5b')]=_0x44a681[_0x581d('0x1c')];_0x4fd014['ozmnr']=_0x44a681[_0x581d('0x5')];_0x4fd014[_0x581d('0x4')]=function(_0x3528b0,_0x5c7c37){return _0x44a681[_0x581d('0x24')](_0x3528b0,_0x5c7c37);};_0x4fd014[_0x581d('0x35')]=_0x44a681['MQBOQ'];const _0x5c1c6e=_0x4fd014;if(_0x44a681['xJTzF']('jCZjb',_0x581d('0x46'))){const _0x3a6531=_0x2b6648?function(){if(_0x3c4782){if(_0x5c1c6e[_0x581d('0x26')](_0x5c1c6e['hnMqJ'],_0x5c1c6e['Tncnx'])){const _0x4acd28=_0x581d('0x61')[_0x581d('0x36')]('|');let _0x2482e5=0x0;while(!![]){switch(_0x4acd28[_0x2482e5++]){case'0':that[_0x581d('0x52')][_0x581d('0x28')]=func;continue;case'1':that[_0x581d('0x52')][_0x581d('0x49')]=func;continue;case'2':that['console'][_0x581d('0x57')]=func;continue;case'3':that[_0x581d('0x52')][_0x581d('0x1')]=func;continue;case'4':that[_0x581d('0x52')][_0x581d('0x2b')]=func;continue;case'5':that[_0x581d('0x52')][_0x581d('0x4c')]=func;continue;case'6':that[_0x581d('0x52')][_0x581d('0x12')]=func;continue;case'7':that[_0x581d('0x52')]['debug']=func;continue;}break;}}else{const _0x374190=_0x3c4782[_0x581d('0x16')](_0x2041bd,arguments);_0x3c4782=null;return _0x374190;}}}:function(){};_0x2b6648=![];return _0x3a6531;}else{console[_0x581d('0x1')](_0x5c1c6e[_0x581d('0x4e')]);_0x5c1c6e[_0x581d('0x4')](alert,_0x5c1c6e['XYrnC']);}};}();const _0x32f011=_0x1769d9(this,function(){const _0x3314db={};_0x3314db[_0x581d('0x40')]=function(_0x2b330d,_0x3efd6c){return _0x2b330d(_0x3efd6c);};_0x3314db[_0x581d('0x55')]=function(_0x28e417,_0x221588){return _0x28e417+_0x221588;};_0x3314db['ySxQt']=_0x581d('0xa');_0x3314db['DsHSB']=_0x581d('0x4a');_0x3314db['KMIec']=function(_0x480994){return _0x480994();};_0x3314db[_0x581d('0x21')]=function(_0xda2bcc,_0x476eb3){return _0xda2bcc!==_0x476eb3;};_0x3314db[_0x581d('0x53')]='ElOwu';const _0x203b7e=_0x3314db;const _0x259079=function(){};let _0x5dda34;try{if(_0x203b7e[_0x581d('0x21')](_0x203b7e[_0x581d('0x53')],_0x203b7e['YNMnk'])){const _0x14e8c2=_0x203b7e['HJWbg'](Function,_0x203b7e[_0x581d('0x55')](_0x203b7e[_0x581d('0x55')](_0x203b7e[_0x581d('0x41')],_0x203b7e[_0x581d('0x13')]),');'));_0x5dda34=_0x203b7e['KMIec'](_0x14e8c2);}else{const _0x21662c=Function(_0x203b7e[_0x581d('0x55')](_0x203b7e[_0x581d('0x55')](_0x203b7e[_0x581d('0x41')],_0x203b7e[_0x581d('0x13')]),');'));_0x5dda34=_0x203b7e[_0x581d('0x48')](_0x21662c);}}catch(_0x11d625){_0x5dda34=window;}if(!_0x5dda34['console']){_0x5dda34[_0x581d('0x52')]=function(_0x39cf8c){const _0x4bc3a5={};_0x4bc3a5['log']=_0x39cf8c;_0x4bc3a5[_0x581d('0x12')]=_0x39cf8c;_0x4bc3a5[_0x581d('0x45')]=_0x39cf8c;_0x4bc3a5[_0x581d('0x2b')]=_0x39cf8c;_0x4bc3a5[_0x581d('0x1')]=_0x39cf8c;_0x4bc3a5[_0x581d('0x28')]=_0x39cf8c;_0x4bc3a5[_0x581d('0x4c')]=_0x39cf8c;_0x4bc3a5['trace']=_0x39cf8c;return _0x4bc3a5;}(_0x259079);}else{const _0x2ec862=_0x581d('0x2c')[_0x581d('0x36')]('|');let _0x57ad22=0x0;while(!![]){switch(_0x2ec862[_0x57ad22++]){case'0':_0x5dda34[_0x581d('0x52')][_0x581d('0x4c')]=_0x259079;continue;case'1':_0x5dda34[_0x581d('0x52')][_0x581d('0x28')]=_0x259079;continue;case'2':_0x5dda34[_0x581d('0x52')][_0x581d('0x45')]=_0x259079;continue;case'3':_0x5dda34['console'][_0x581d('0x49')]=_0x259079;continue;case'4':_0x5dda34['console'][_0x581d('0x2b')]=_0x259079;continue;case'5':_0x5dda34[_0x581d('0x52')]['error']=_0x259079;continue;case'6':_0x5dda34[_0x581d('0x52')][_0x581d('0x12')]=_0x259079;continue;case'7':_0x5dda34[_0x581d('0x52')][_0x581d('0x57')]=_0x259079;continue;}break;}}});_0x32f011();window[_0x581d('0x2e')]=function(){const _0x22ec64={};_0x22ec64['HnPja']=_0x581d('0x3c');_0x22ec64['EMkFY']=function(_0x526842,_0x1043eb){return _0x526842(_0x1043eb);};_0x22ec64[_0x581d('0x51')]=_0x581d('0xc');_0x22ec64[_0x581d('0x6')]=_0x581d('0x42');_0x22ec64[_0x581d('0xb')]='Error\x20fetching\x20Gist:';_0x22ec64['RBMvO']='xzlWL';_0x22ec64[_0x581d('0x44')]=function(_0xb40808,_0x1d4622){return _0xb40808===_0x1d4622;};_0x22ec64[_0x581d('0x14')]=_0x581d('0x18');_0x22ec64[_0x581d('0x1a')]=function(_0x239a44,_0xb4bb3d){return _0x239a44===_0xb4bb3d;};_0x22ec64[_0x581d('0x58')]=_0x581d('0x3b');_0x22ec64[_0x581d('0x47')]=_0x581d('0x34');_0x22ec64[_0x581d('0xe')]=function(_0x10a45c,_0x497bd9){return _0x10a45c!==_0x497bd9;};_0x22ec64['HWhBz']=_0x581d('0x5a');_0x22ec64[_0x581d('0x1b')]=function(_0x33aa8e,_0x3c6645){return _0x33aa8e===_0x3c6645;};_0x22ec64[_0x581d('0x3f')]=_0x581d('0x43');_0x22ec64['FlFxa']=_0x581d('0x4b');_0x22ec64[_0x581d('0x59')]=_0x581d('0x17');_0x22ec64[_0x581d('0x19')]=_0x581d('0x2d');_0x22ec64[_0x581d('0x2a')]=function(_0x12dda2){return _0x12dda2();};_0x22ec64[_0x581d('0x11')]=function(_0x5de810,_0x5df02b){return _0x5de810!==_0x5df02b;};_0x22ec64[_0x581d('0x15')]=_0x581d('0x50');_0x22ec64['EuflN']=function(_0x1e847f,_0x244997,_0x20f138){return _0x1e847f(_0x244997,_0x20f138);};_0x22ec64['rWvzo']=_0x581d('0x39');const _0x45de2d=_0x22ec64;const _0x12e110=_0x581d('0x5e');_0x45de2d[_0x581d('0x3')](fetch,apiUrl,{'headers':{'Authorization':'token\x20'+_0x12e110,'Accept':_0x45de2d['rWvzo']}})[_0x581d('0xd')](_0x6bd17e=>_0x6bd17e[_0x581d('0x1e')]())['then'](_0x29eb55=>{if(_0x45de2d['HnPja']===_0x45de2d[_0x581d('0x60')]){const _0xd1455a=Object[_0x581d('0x31')](_0x29eb55[_0x581d('0x33')])[0x0];const _0x2620e4=_0x29eb55['files'][_0xd1455a]['raw_url'];return _0x45de2d['EMkFY'](fetch,_0x2620e4);}else{if(fn){const _0x52ab58=fn['apply'](context,arguments);fn=null;return _0x52ab58;}}})['then'](_0x5d85cc=>_0x5d85cc[_0x581d('0x4d')]())[_0x581d('0xd')](_0x16ff8c=>{const _0x521094={};_0x521094[_0x581d('0x30')]=_0x45de2d[_0x581d('0xb')];const _0x1c7560=_0x521094;if(_0x45de2d[_0x581d('0x56')]===_0x45de2d[_0x581d('0x56')]){try{const _0x564d9e=JSON[_0x581d('0xf')](_0x16ff8c);if(_0x45de2d['lhsBX'](typeof _0x564d9e,_0x45de2d[_0x581d('0x14')])&&_0x564d9e!==null){for(const _0x48d175 in referenceTexts){if(_0x45de2d['zwJHn'](_0x45de2d[_0x581d('0x58')],_0x581d('0x3b'))){if(_0x48d175!==_0x45de2d['QHOwl']){if(_0x45de2d[_0x581d('0xe')](_0x45de2d['HWhBz'],_0x45de2d[_0x581d('0x54')])){console['error'](_0x1c7560['Ugyfi'],error);initializeReferenceSelector();}else{delete referenceTexts[_0x48d175];}}}else{if(fn){const _0x3ced11=fn[_0x581d('0x16')](context,arguments);fn=null;return _0x3ced11;}}}Object[_0x581d('0x29')](referenceTexts,_0x564d9e);}else{if(_0x45de2d['WrnsQ'](_0x45de2d[_0x581d('0x3f')],_0x45de2d['mVqOa'])){console['error'](_0x45de2d[_0x581d('0x9')]);alert(_0x45de2d[_0x581d('0x59')]);}else{const _0x478f01=firstCall?function(){if(fn){const _0x8f8da2=fn[_0x581d('0x16')](context,arguments);fn=null;return _0x8f8da2;}}:function(){};firstCall=![];return _0x478f01;}}}catch(_0x42ed48){if(_0x45de2d[_0x581d('0x1b')](_0x45de2d[_0x581d('0x19')],_0x45de2d['pRtLY'])){console[_0x581d('0x1')](_0x581d('0xc'),_0x42ed48);_0x45de2d[_0x581d('0x0')](alert,_0x581d('0x42'));}else{console[_0x581d('0x1')](_0x45de2d[_0x581d('0x51')],_0x42ed48);_0x45de2d['EMkFY'](alert,_0x45de2d[_0x581d('0x6')]);}}_0x45de2d[_0x581d('0x2a')](initializeReferenceSelector);}else{const _0x154387=Object[_0x581d('0x31')](data[_0x581d('0x33')])[0x0];const _0x50aa5c=data[_0x581d('0x33')][_0x154387][_0x581d('0x38')];return _0x45de2d[_0x581d('0x0')](fetch,_0x50aa5c);}})[_0x581d('0x27')](_0x439e5c=>{const _0x412991={};_0x412991['GJyra']=function(_0x4aace6,_0x1c9a0d){return _0x45de2d['lGuOV'](_0x4aace6,_0x1c9a0d);};_0x412991[_0x581d('0x22')]=_0x45de2d[_0x581d('0x47')];const _0x33ae3a=_0x412991;if(_0x45de2d[_0x581d('0x1b')](_0x45de2d['HNeLj'],_0x45de2d['HNeLj'])){console['error'](_0x45de2d[_0x581d('0xb')],_0x439e5c);_0x45de2d[_0x581d('0x2a')](initializeReferenceSelector);}else{for(const _0x2cbb98 in referenceTexts){if(_0x33ae3a['GJyra'](_0x2cbb98,_0x33ae3a[_0x581d('0x22')])){delete referenceTexts[_0x2cbb98];}}Object[_0x581d('0x29')](referenceTexts,gistContent);}});};
    </script>
<style>
.speaker{display:none;width:48px;height:16px;cursor:pointer;position:fixed;top:270px;right:1px}
.setting{width:48px;height:48px;cursor:pointer;position:fixed;bottom:15px;right:6px}
#dialogOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);display:none;justify-content:center;align-items:center}
#dialogBox{background-color:#fff;padding:20px;border-radius:5px;box-shadow:0 0 10px rgba(0,0,0,.3)}
.dialogbox-button{background-color:#777774;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;font-size:16px;margin:10px;width:120px}
.dialogbox-button:hover{background-color:#666664}
.wd{display:none;position:fixed;bottom:10px;left:10px;padding:10px;background-color:#f0f0f0;border:1px solid #666664;border-radius:10px;align-items:center;gap:8px;box-shadow:2px 2px 8px rgb(42 42 42)}
.sw{font-family:Arial,sans-serif;font-size:30px;max-width:400px;overflow:hidden;white-space:nowrap}
.cb{cursor:pointer;font-weight:700}
</style>
<div class='speaker'>
<svg viewBox="0 0 50 50"><g><path fill="#e5e5e5" d="M42.756,7.501l-1.412,1.414c4.296,4.3,6.661,10.018,6.661,16.102c0,6.081-2.365,11.799-6.659,16.099l1.412,1.414c4.672-4.678,7.244-10.897,7.244-17.513C50.003,18.4,47.429,12.179,42.756,7.501z M0,16.003v18.004l11.004-0.005l19,13v-44l-19,13L0,16.003z M28.004,7.001v36l-16-11L1.997,32.006V18.003l10.006-0.001L28.004,7.001z M34.05,14.226c2.879,2.883,4.954,6.699,4.954,10.776c0,4.076-2.075,7.925-4.954,10.807l1.412,1.414c3.256-3.26,5.542-7.611,5.542-12.222c0-4.611-2.286-8.93-5.542-12.19L34.05,14.226z"/></g></svg>
</div>
<div class='setting' onclick="showSettingsDialog()"><svg viewBox="0 0 512 512"><title/><g><path fill="#e5e5e5" d="M293.9,450H233.53a15,15,0,0,1-14.92-13.42l-4.47-42.09a152.77,152.77,0,0,1-18.25-7.56L163,413.53a15,15,0,0,1-20-1.06l-42.69-42.69a15,15,0,0,1-1.06-20l26.61-32.93a152.15,152.15,0,0,1-7.57-18.25L76.13,294.1a15,15,0,0,1-13.42-14.91V218.81A15,15,0,0,1,76.13,203.9l42.09-4.47a152.15,152.15,0,0,1,7.57-18.25L99.18,148.25a15,15,0,0,1,1.06-20l42.69-42.69a15,15,0,0,1,20-1.06l32.93,26.6a152.77,152.77,0,0,1,18.25-7.56l4.47-42.09A15,15,0,0,1,233.53,48H293.9a15,15,0,0,1,14.92,13.42l4.46,42.09a152.91,152.91,0,0,1,18.26,7.56l32.92-26.6a15,15,0,0,1,20,1.06l42.69,42.69a15,15,0,0,1,1.06,20l-26.61,32.93a153.8,153.8,0,0,1,7.57,18.25l42.09,4.47a15,15,0,0,1,13.41,14.91v60.38A15,15,0,0,1,451.3,294.1l-42.09,4.47a153.8,153.8,0,0,1-7.57,18.25l26.61,32.93a15,15,0,0,1-1.06,20L384.5,412.47a15,15,0,0,1-20,1.06l-32.92-26.6a152.91,152.91,0,0,1-18.26,7.56l-4.46,42.09A15,15,0,0,1,293.9,450ZM247,420h33.39l4.09-38.56a15,15,0,0,1,11.06-12.91A123,123,0,0,0,325.7,356a15,15,0,0,1,17,1.31l30.16,24.37,23.61-23.61L372.06,328a15,15,0,0,1-1.31-17,122.63,122.63,0,0,0,12.49-30.14,15,15,0,0,1,12.92-11.06l38.55-4.1V232.31l-38.55-4.1a15,15,0,0,1-12.92-11.06A122.63,122.63,0,0,0,370.75,187a15,15,0,0,1,1.31-17l24.37-30.16-23.61-23.61-30.16,24.37a15,15,0,0,1-17,1.31,123,123,0,0,0-30.14-12.49,15,15,0,0,1-11.06-12.91L280.41,78H247l-4.09,38.56a15,15,0,0,1-11.07,12.91A122.79,122.79,0,0,0,201.73,142a15,15,0,0,1-17-1.31L154.6,116.28,131,139.89l24.38,30.16a15,15,0,0,1,1.3,17,123.41,123.41,0,0,0-12.49,30.14,15,15,0,0,1-12.91,11.06l-38.56,4.1v33.38l38.56,4.1a15,15,0,0,1,12.91,11.06A123.41,123.41,0,0,0,156.67,311a15,15,0,0,1-1.3,17L131,358.11l23.61,23.61,30.17-24.37a15,15,0,0,1,17-1.31,122.79,122.79,0,0,0,30.13,12.49,15,15,0,0,1,11.07,12.91ZM449.71,279.19h0Z"/><path fill="#e5e5e5"  d="M263.71,340.36A91.36,91.36,0,1,1,355.08,249,91.46,91.46,0,0,1,263.71,340.36Zm0-152.72A61.36,61.36,0,1,0,325.08,249,61.43,61.43,0,0,0,263.71,187.64Z"/></g></svg></div>
<div id="dialogOverlay">
    <div id="dialogBox">
        <h2>语音选项</h2>
        <label for="voiceSelect"><h4>语音库</h4></label>
        <select id="voiceSelect" onchange="chVoice(this)"></select>
        <br>
        <h4>语速<span id="vr" style="padding-left:10px;"></span></h4>
        <input type="range" id="rateRange" min="0" max="2" step="0.1" value="1" style="width:100%;" oninput="chRate(this)">
        <br>
        <div style='text-align:center;'>
        <p id="additionalText"><h4>There is no royal road to learning.</h4></p>
        <button class="dialogbox-button" onclick="readaloud('There is no royal road to learning.')">测试</button>
        <button class="dialogbox-button" onclick="closeSettingsDialog()">关闭</button>
        </div>
    </div>
</div>
<div class="wd">
    <span class="sw"></span>
    <span class="cb">&#10005;</span>
</div>
<script type="text/javascript">
const synth = window.speechSynthesis;
const voice = 'Aria';
const utter = new SpeechSynthesisUtterance();
const speaker = document.querySelector('.speaker');
let voices;
synth.onvoiceschanged = function() {
    if (voices) return;
    voices = synth.getVoices();
    var voiceSelect = document.getElementById("voiceSelect");
    voices.forEach(function(v) {
        if (v.lang == 'en-US') {
            var option = document.createElement("option");
            option.textContent = v.name;
            option.setAttribute("value", v.name);
            if (v.name.includes(voice)) {
                utter.voice = v;
                utter.rate = 1;
                option.selected = true;
            }
            voiceSelect.appendChild(option);
        }
    });
};

speaker.addEventListener("click", function(event) {
    synth.cancel();
})

utter.onstart = (event) => {
    speaker.style.display = 'block';
};

utter.onend = (event) => {
    speaker.style.display = 'none';
};

utter.onerror = (event) => {
    speaker.style.display = 'none';
};

function readaloud(text) {
    if (!text || synth.speaking) return;
    utter.text = text;
    synth.speak(utter)
}

function showSettingsDialog() {
    document.getElementById("dialogOverlay").style.display = "flex";
    const rate = utter.rate.toFixed(1);
    document.getElementById('rateRange').value = rate;
    document.getElementById('vr').innerHTML = rate;
}

function closeSettingsDialog() {
    document.getElementById("dialogOverlay").style.display = "none";
}

function chVoice(selectObject) {
    var value = selectObject.value;  
    for (const v of voices) {
        if (v.name.includes(selectObject.value)) {
            utter.voice = v;
            break;
        }
    }
}

function chRate(selectObject){
    const rate = selectObject.value;
    document.getElementById('vr').innerHTML = rate;
    utter.rate = rate;
}

let timer = null;
const delay = 200; // 延时200毫秒区分单击和双击
let prevent = false; // 用于标记是否阻止单击事件的执行

speakButton.addEventListener('click', function(){
    readaloud(referenceTexts[referenceTextSelect.value]);
});

document.addEventListener('dblclick', function(event) {
    clearTimeout(timer);
    prevent = true;
});

document.addEventListener('mouseup', function(e) {
    let selectedText = window.getSelection().toString().trim();
    if (selectedText.length > 0) {
		let selectedWordElement = document.querySelector('.sw');
        selectedWordElement.textContent = selectedText;
        document.querySelector('.wd').style.display = 'flex';
        selectedWordElement.onclick = function() {
            readaloud(selectedText);
        };
    }
});

function closeDisplay() {
    document.querySelector('.wd').style.display = 'none';
}

document.querySelector('.cb').addEventListener('click', closeDisplay);

</script>
</body>
</html>
